{% extends 'base.html.twig' %}
{% block title %}Berichte{% endblock %}

{% block body %}
<div class="container mt-4">
    <h2>Bericht-Visualisierung</h2>
    <form id="reportForm" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="diagramType" class="form-label">Diagrammtyp</label>
            <select id="diagramType" class="form-select">
                <option value="bar">Balken</option>
                <option value="pie">Torte</option>
                <option value="line">Linie</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="xField" class="form-label">X-Achse</label>
            <select id="xField" class="form-select">
                <option value="spieler">Spieler</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="yField" class="form-label">Y-Achse</label>
            <select id="yField" class="form-select">
                <option value="tore">Tore</option>
                <option value="minuten">Spielminuten</option>
            </select>
        </div>
        <div class="col-md-3 align-self-end">
            <button type="submit" class="btn btn-primary">Anzeigen</button>
        </div>
    </form>
    <canvas id="reportChart" height="100"></canvas>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.getElementById('reportForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const diagramType = document.getElementById('diagramType').value;
    const xField = document.getElementById('xField').value;
    const yField = document.getElementById('yField').value;

    fetch(`/api/report?diagramType=${diagramType}&xField=${xField}&yField=${yField}`)
        .then(res => res.json())
        .then(data => {
            renderChart(data);
        });
});

let chartInstance = null;
function renderChart(data) {
    const ctx = document.getElementById('reportChart').getContext('2d');
    if (chartInstance) chartInstance.destroy();
    chartInstance = new Chart(ctx, {
        type: data.diagramType,
        data: {
            labels: data.labels,
            datasets: [{
                label: data.yField || 'Wert',
                data: data.values,
                backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545'],
            }]
        }
    });
}
</script>
{% endblock %}
