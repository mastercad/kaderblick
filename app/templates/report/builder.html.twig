{#
    templates/report/builder.html.twig
    Report builder form for creating/editing user reports and templates.
#}

{% extends 'base.html.twig' %}

{% block title %}Report Builder{% endblock %}

{% block body %}
<h1>{{ report is defined and report.id ? 'Edit Report' : 'Create Report' }}</h1>
<form method="post" action="{{ form_action }}">
    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control" id="name" name="name" value="{{ report.name|default('') }}" required>
    </div>
    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" name="description">{{ report.description|default('') }}</textarea>
    </div>
    <div class="mb-3">
        <label for="diagramType" class="form-label">Diagram Type</label>
        <select class="form-select" id="diagramType" name="config[diagramType]">
            <option value="bar" {{ (report.config.diagramType|default('bar')) == 'bar' ? 'selected' : '' }}>Bar</option>
            <option value="line" {{ (report.config.diagramType|default('bar')) == 'line' ? 'selected' : '' }}>Line</option>
            <option value="pie" {{ (report.config.diagramType|default('bar')) == 'pie' ? 'selected' : '' }}>Pie</option>
        </select>
    </div>
    <div class="mb-3">
        <label for="xField" class="form-label">X-Achse</label>
        <select class="form-select" id="xField" name="config[xField]">
            {% for key, alias in fieldAliases %}
                <option value="{{ key }}" {{ (report.config.xField|default('player')) == key ? 'selected' : '' }}>{{ alias.label }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label for="yField" class="form-label">Y-Achse</label>
        <select class="form-select" id="yField" name="config[yField]">
            {% for key, alias in fieldAliases %}
                <option value="{{ key }}" {{ (report.config.yField|default('goals')) == key ? 'selected' : '' }}>{{ alias.label }}</option>
            {% endfor %}
        </select>
    </div>
    {# Add filter fields as needed #}
    {% if is_granted('ROLE_ADMIN') %}
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="isTemplate" name="isTemplate" value="1" {{ report.isTemplate ? 'checked' : '' }}>
            <label class="form-check-label" for="isTemplate">Save as template (visible for all users)</label>
        </div>
    {% endif %}
    <button type="submit" class="btn btn-primary">Save</button>
</form>
{% endblock %}
