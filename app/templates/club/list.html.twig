{% extends 'base.html.twig' %}

{% block title %}Vereine{% endblock %}

{% block body %}
<h1>Vereine</h1>
<div id="club-list-loading" style="text-align:center; padding:2em;">
    <span class="spinner-border" role="status"></span> Vereine werden geladen...
</div>
<table id="club-list-table" class="table table-striped" style="display: none;">
    <thead>
        <tr>
            <th>Name</th>
            <th>Stadion</th>
            <th>Website</th>
            <th>Aktionen</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('/api/clubs/list')
        .then(response => response.json())
        .then(data => {
            const clubs = Object.keys(data)
                .filter(key => !isNaN(Number(key)))
                .map(key => data[key]);
            const tbody = document.querySelector('#club-list-table tbody');
            tbody.innerHTML = '';
            if (clubs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">Keine Vereine gefunden.</td></tr>';
            } else {
                clubs.forEach(club => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${club.name || ''}</td>
                        <td>${club.stadiumName || ''}</td>
                        <td>${club.website || ''}</td>
                        <td><a href="/clubs/${club.id}/detail" class="btn btn-primary" data-modal>Details</a></td>
                    `;
                    tbody.appendChild(tr);
                });
            }
            document.getElementById('club-list-loading').style.display = 'none';
            document.getElementById('club-list-table').style.display = '';
        })
        .catch(() => {
            document.getElementById('club-list-loading').innerHTML = 'Fehler beim Laden der Vereine.';
        });
});
</script>
{% endblock %}
