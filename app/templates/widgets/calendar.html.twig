<div id="calendar-widget-{{ widget.id }}" class="small-calendar"></div>

<script>
    var calendarEl = document.getElementById('calendar-widget-{{ widget.id }}');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        dateClick: function(info) {
            window.location.href = `/calendar?view=day&date=${info.dateStr}`;
        },
        locale: 'de',
        height: 'auto',
        headerToolbar: {
            left: 'prev',
            center: 'title',
            right: 'next'
        },
        events: '{{ path('api_calendar_events') }}',
        eventDidMount: function(info) {
            // Participation status icon (CSS only)
            const status = info.event.extendedProps.participation_status;
            let iconHtml = '';
            if (status && status.icon) {
                iconHtml = `<span class=\"event-status-icon\" title=\"${status.name}\"><i class=\"${status.icon}\"></i></span>`;
            } else if (status && status.code) {
                iconHtml = `<span class=\"event-status-dot event-status-dot--custom\" title=\"${status.name}\" style=\"background:${status.color||'#888'}\"></span>`;
            } else {
                iconHtml = `<span class=\"event-status-icon\" title=\"Keine Antwort\"><i class=\"fas fa-question-circle text-secondary\"></i></span>`;
            }
            const titleEl = info.el.querySelector('.fc-event-title') || info.el;
            titleEl.insertAdjacentHTML('afterbegin', iconHtml + ' ');
        },
    });
    calendar.render();

    function convertDate(dateStr) {
        const yyyy = dateStr.getFullYear();
        const mm = String(dateStr.getMonth() + 1).padStart(2, '0'); // Monat (06)
        const dd = String(dateStr.getDate()).padStart(2, '0');      // Tag (30)
        const yyyyMmDd = `${yyyy}-${mm}-${dd}`;

        return yyyyMmDd;
    }
</script>

<style>
.small-calendar {
    min-height: 300px;
}
</style>
